!function(top){"use strict";function restore(e){return e.nodeMarks=[],e.nodeRepeats=[],e.node=e.node||{},e.node.innerHTML=e.sourceHTML,e}function compile(e,o,t){return t=t||$mvc.mapNode.rootNode,$mvc.console("group","$mvc compile",5),$mvc.console("log","renderScope Name : "+o.name,"#33f",5),$mvc.console("log","renderScope Path : "+o.path.join(" -> "),"#69f",5),$mvc.console("log","renderScope Element TagName : "+o.node.localName,"#69f",5),o.node.id?$mvc.console("log","renderScope Element Id : "+o.node.id,"#69f",5):null,o.node.className?$mvc.console("log","renderScope Element Class : "+o.node.className,"#69f",5):null,$mvc.console("time","Elapsed Time"),o.node=$mvc.mapNode.getElementsByAttributeName(t,"x-path",e.join("."))[0],$mvc.mapNode.restore(e,o),o=mapRepeatNode(o),o=filtNodeMarks(o),o=compileNodeMarks(o),$mvc.isNodeRuntime?o.node.removeAttribute("x-include"):null,$mvc.isNodeRuntime?o.node.removeAttribute("x-render"):null,$mvc.isNodeRuntime?o.node.removeAttribute("x-path"):null,$mvc.console("log","renderScope Repeats : "+o.nodeRepeats.length,"#69f",5),$mvc.console("log","renderScope Marks : "+o.nodeMarks.length,"#69f",5),$mvc.console("timeEnd","Elapsed Time",5),$mvc.console("groupEnd","$mvc compile",5),o}function mapRepeatNode(nodeData){var matchTask=function(node,attributeValue,tier){var tierRegExp=new RegExp("\\$"+tier,"g"),tempRepeat={repeatMark:attributeValue,repeatHTML:node.innerHTML,repeatTier:tier};nodeData.nodeRepeats.push(tempRepeat);var repeatTimes=0,compileHTML="";if("object"===eval("typeof("+tempRepeat.repeatMark+")"))for(repeatTimes;repeatTimes<eval(tempRepeat.repeatMark+".length");repeatTimes++){var tempHTML=tempRepeat.repeatHTML;tempHTML=tempHTML.replace(tierRegExp,repeatTimes),compileHTML+=tempHTML}else $mvc.console("warn",tempRepeat.repeatMark+" is not Array!",null,1);node.innerHTML=compileHTML,$mvc.mapNode.mapNodeByAttributeName(node,"x-repeat",tier+1,matchTask)};return nodeData.node=$mvc.mapNode.mapNodeByAttributeName(nodeData.node,"x-repeat",0,matchTask),nodeData}function filtNodeMarks(e){return e.nodeMarks=(e.node.innerHTML||"").match($mvc.regex.nodeMark)||[],e}function compileNodeMarks(nodeData){for(var htmlStr=nodeData.node.innerHTML,mapedMarks=nodeData.nodeMarks,mark3LRegex=new RegExp("{{{"),mark3RRegex=new RegExp("}}}"),markFixRegex=[new RegExp("{","g"),new RegExp("}","g"),new RegExp("<","g"),new RegExp(">","g"),new RegExp('}}=""',"g"),new RegExp('"',"g")],tempMark,tempStr,isTrueElement,i=0;i<mapedMarks.length;i++)isTrueElement=mark3LRegex.test(mapedMarks[i])&&mark3RRegex.test(mapedMarks[i]),htmlStr=htmlStr.replace(markFixRegex[4],"}}"),tempMark=mapedMarks[i].replace(markFixRegex[0],""),tempMark=tempMark.replace(markFixRegex[1],""),"undefined"!=eval("typeof("+tempMark+")")?(tempStr=String(eval(tempMark)),isTrueElement?null:tempStr=tempStr.replace(markFixRegex[2],"&#60;"),isTrueElement?null:tempStr=tempStr.replace(markFixRegex[3],"&#62;"),htmlStr=htmlStr.replace(mapedMarks[i],tempStr)):htmlStr=htmlStr.replace(mapedMarks[i],"");return nodeData.node.innerHTML!==htmlStr&&(nodeData.node.innerHTML=htmlStr),nodeData}var root={},$mvc={name:"mvc9.js(mvc9.com)",version:"1.2.1",logLevel:0};return $mvc.isNodeRuntime=!Boolean(top.location),root=$mvc.isNodeRuntime?global:window,root.m={description:"Model Data Property"},root.v={description:"View renderScope Property"},root.c={description:"Control Property"},$mvc.root=root,$mvc.root.$x?$mvc.root.$x:($mvc.console=function(e,o,t,n){if(n=n||1,$mvc.logLevel>=n)if(console.time)switch(e){case"time":console.time(o);break;case"timeEnd":console.timeEnd(o);break;case"group":t=t||"#666",console.group("%c"+o,"color:"+t);break;case"groupEnd":console.groupEnd(o);break;case"log":t=t||"#111",console.log("%c"+o,"color:"+t);break;case"warn":t=t||"f96",console.warn("%c"+o,"color"+t)}else switch(e){case"log":console.log(o);break;case"warn":console.warn(o);break;case"error":console.error(o)}},$mvc.httpComSequence=[],$mvc.httpCom=function(e){function o(){if(4==m.readyState){for(var o=0;o<$mvc.httpComSequence.length;o++)setTimeout(function(){$mvc.httpComSequence=$mvc.httpComSequence.slice(0,o-1).concat($mvc.httpComSequence.slice(o,$mvc.httpComSequence.length-1))},e.delay);e.finishCallback(m.status,m.responseText)}}function t(){var e=null;try{e=new XMLHttpRequest}catch(o){try{e=new ActiveXObject("Msxml2.XMLHTTP")}catch(o){e=new ActiveXObject("Microsoft.XMLHTTP")}}return e}if(e={name:e.name||"null",crackCallback:e.crackCallback||function(e){console.warn("httpCom(name:"+e+") is canceled because of an unfinished httpCom request with same name!")},url:e.url||window.location.href,method:e.method||"GET",header:e.header||{},contentType:e.contentType||"application/x-www-form-urlencoded",content:e.content||"",async:!!e.async||!0,delay:e.delay||100,finishCallback:e.finishCallback||function(){}},e.header["Content-Type"]=e.contentType,e.contentType.match(/application\/x-www-form-urlencoded/g)){if(e.header.push({"X-Requested-With":"XMLHttpRequest"}),"object"==typeof e.content){var n="";for(var r in e.content)n=n?n+"&"+encodeURIComponent(r)+"="+encodeURIComponent(e.content[r]):encodeURIComponent(r)+"="+encodeURIComponent(e.content[r]);e.content=n}}else JSON&&"object"==typeof e.content&&(e.content=JSON.stringify(e.content));if(!e.name)return void console.error("$mvc.httpCom param.name can not be omitted!");for(var a=0;a<$mvc.httpComSequence.length;a++)if($mvc.httpComSequence[a]==e.name)return void e.crackCallback(e.name);$mvc.httpComSequence.push(e.name);var m=null;if(m=t(),null==m)return void alert("Your brower dose not support AJAX!");m.onreadystatechange=o,m.open(e.method,e.url,e.async);for(var r in e.header)m.setRequestHeader(r,e.header[r]);return m.send(e.content),e},$mvc.onload=function(e,o){function t(){if(e(),o){$mvc.mapNode.rootNode=document,$mvc.mapNode.mapRenderToMold(document),$mvc.mapNode.renderScopePath(),$mvc.mapNode.molds=[],$mvc.mapNode.mapRenderToMold(document);for(var t=0;t<$mvc.mapNode.molds.length;t++)compile($mvc.mapNode.molds[t].path,$mvc.mapNode.molds[t])}}window.addEventListener?window.addEventListener("load",function(e){t()}):window.attachEvent("onload",function(e){t()})},$mvc.regex={},$mvc.regex.nodeMark=new RegExp("{{2,3}[^{}]*}{2,3}","g"),$mvc.regex.HTMLMark=new RegExp("<html>(.*s)*</html>"),$mvc.regex.scopePathMark=new RegExp("\\$path","g"),$mvc.regex.isReaptTier=new RegExp("\\$\\d+"),$mvc.mapNode={},$mvc.mapNode.molds=[],$mvc.mapNode.emptyDom=function(){return{childNodes:[],innerHTML:""}},$mvc.isNodeRuntime?$mvc.mapNode.rootNode=new $mvc.mapNode.emptyDom:$mvc.mapNode.rootNode=document,$mvc.init=function(){delete $mvc.mapNode.rootNode,delete $mvc.mapNode.molds,delete $mvc.root.m,delete $mvc.root.v,delete $mvc.root.c,$mvc.mapNode.rootNode=new $mvc.mapNode.emptyDom,$mvc.mapNode.molds=[],$mvc.root.m={description:"Model Data Property"},$mvc.root.v={description:"View renderScope Property"},$mvc.root.c={description:"Control Property"}},$mvc.mapNode.mapNodeByAttributeName=function(e,o,t,n){e=e||$mvc.mapNode.emptyDom;for(var r=0;r<(e.childNodes||[]).length;r++)if(e.childNodes[r].attributes){for(var a=0;a<e.childNodes[r].attributes.length;a++)if(e.childNodes[r].attributes[a].nodeName&&e.childNodes[r].attributes[a].nodeName===o){n(e.childNodes[r],e.childNodes[r].attributes[a].nodeValue,t);break}a===e.childNodes[r].attributes.length&&$mvc.mapNode.mapNodeByAttributeName(e.childNodes[r],o,t,n)}return e},$mvc.mapNode.getElementsByAttributeName=function(e,o,t){var n=[],r=function(e,a){t?a===t&&n.push(e):n.push(e),$mvc.mapNode.mapNodeByAttributeName(e,o,null,r)};return $mvc.mapNode.mapNodeByAttributeName(e,o,null,r),n},$mvc.mapNode.mapIncludes=function(e,o,t){var n=function(e,r,a){var m=o(t+r);m!==!1&&(e.innerHTML=m,$mvc.mapNode.mapNodeByAttributeName(e,"x-include",null,n))};return $mvc.mapNode.mapNodeByAttributeName(e,"x-include",null,n),e},$mvc.mapNode.mapRenderToMold=function(e){var o=function(e,t,n){var r=e.attributes["x-render"].value,a=n.join('"').match(/[^\"]+/g)||[];a.push(r),e.setAttribute("x-path",a.join(".")),$mvc.regex.isReaptTier.test(r)?null:$mvc.mapNode.mold(r,e,a),$mvc.mapNode.mapNodeByAttributeName(e,"x-render",a,o)};$mvc.mapNode.mapNodeByAttributeName(e,"x-render",[],o)},$mvc.mapNode.renderScopePath=function(){for(var e=$mvc.mapNode.molds.length;e>0;e--){var o=$mvc.mapNode.molds[e-1];o.node.innerHTML=o.node.innerHTML.replace($mvc.regex.scopePathMark,o.path.join("']['"))}},$mvc.mapNode.mold=function(e,o,t,n,r){$mvc.mapNode.molds.push({name:e,node:o,path:t||[],nodeMarks:[],nodeRepeats:[],sourceHTML:o.innerHTML,beforeCompile:n,afterCompile:r})},$mvc.mapNode.restore=function(e){for(var o=0;o<$mvc.mapNode.molds.length;o++)$mvc.mapNode.molds[o].path.join('"')===e.join('"')&&restore($mvc.mapNode.molds[o])},$mvc.mapNode.compile=function(e){for(var o,t=0;t<$mvc.mapNode.molds.length;t++){var n=$mvc.mapNode.molds[t];if(n.path.join('"')===e.join('"')){n.beforeCompile?n.beforeCompile():null,o=compile(e,n),n.afterCompile?n.afterCompile():null;break}}return o||console.warn("cannot find renderScope mold by renderScopePath ['"+e.join("']['")+"']")},root.$x=$mvc,$mvc)}(this);