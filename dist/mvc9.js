!function(top){"use strict";function restore(e){return e.nodeMarks=[],e.nodeRepeats=[],e.node.innerHTML=e.sourceHTML,e}function compile(e,o){return $mvc.console("group","$mvc compile",5),$mvc.console("log","Template Name : "+e,"#33f",5),$mvc.console("log","Template Element TagName : "+o.node.localName,"#69f",5),o.node.id?$mvc.console("log","Template Element Id : "+o.node.id,"#69f",5):null,o.node.className?$mvc.console("log","Template Element Class : "+o.node.className,"#69f",5):null,$mvc.console("time","Elapsed Time"),$mvc.mapNode.restore(e,o),o=filtRepeatNode(o),o=filtNodeMarks(o),o=compileNodeMarks(o),$mvc.console("log","Template Repeats : "+o.nodeRepeats.length,"#69f",5),$mvc.console("log","Template Marks : "+o.nodeMarks.length,"#69f",5),$mvc.console("timeEnd","Elapsed Time",5),$mvc.console("groupEnd","$mvc compile",5),o}function filtRepeatNode(nodeData){function mapChildFindRepeat(node,tier){for(var i=0;i<node.childNodes.length;i++)if(node.childNodes[i].attributes){for(var n=0;n<node.childNodes[i].attributes.length;n++)if(node.childNodes[i].attributes[n].nodeName&&"mvc-repeat"==node.childNodes[i].attributes[n].nodeName){var tierRegExp=new RegExp("\\$"+tier,"g"),tempRepeat={repeatMark:node.childNodes[i].attributes[n].nodeValue,repeatHTML:node.childNodes[i].innerHTML,repeatTier:tier};nodeData.nodeRepeats.push(tempRepeat);var repeatTimes=0,compileHTML="";if("object"==eval("typeof("+tempRepeat.repeatMark+")"))for(repeatTimes;repeatTimes<eval(tempRepeat.repeatMark+".length");repeatTimes++){var tempHTML=tempRepeat.repeatHTML;tempHTML=tempHTML.replace(tierRegExp,repeatTimes),compileHTML+=tempHTML}else $mvc.console("warn",tempRepeat.repeatMark+" is not Array!",null,1);node.childNodes[i].innerHTML=compileHTML,mapChildFindRepeat(node.childNodes[i],tier+1);break}n==node.childNodes[i].attributes.length&&mapChildFindRepeat(node.childNodes[i],tier)}}return mapChildFindRepeat(nodeData.node,0),nodeData}function filtNodeMarks(e){return e.nodeMarks=e.node.innerHTML.match($mvc.regex.NodeMark)||[],e}function compileNodeMarks(nodeData){for(var htmlStr=nodeData.node.innerHTML,mapedMarks=nodeData.nodeMarks,mark3LRegex=new RegExp("{{{"),mark3RRegex=new RegExp("}}}"),markFixRegex=[new RegExp("{","g"),new RegExp("}","g"),new RegExp('=""',"g"),new RegExp("<","g"),new RegExp(">","g")],tempMark,tempStr,isTrueElement,i=0;i<mapedMarks.length;i++)isTrueElement=mark3LRegex.test(mapedMarks[i])&&mark3RRegex.test(mapedMarks[i]),tempMark=mapedMarks[i].replace(markFixRegex[0],""),tempMark=tempMark.replace(markFixRegex[1],""),tempMark=tempMark.replace(markFixRegex[2],""),"undefined"!=eval("typeof("+tempMark+")")?(tempStr=String(eval(tempMark)),isTrueElement?null:tempStr=tempStr.replace(markFixRegex[3],"&#60;"),isTrueElement?null:tempStr=tempStr.replace(markFixRegex[4],"&#62;"),htmlStr=htmlStr.replace(mapedMarks[i],tempStr)):htmlStr=htmlStr.replace(mapedMarks[i],"");return nodeData.node.innerHTML!==htmlStr&&(nodeData.node.innerHTML=htmlStr),nodeData}var root={},$mvc={name:"mvc9.js(mvc9.com)",version:"0.9.1 Beta",logLevel:0};$mvc.isNodeRuntime=!Boolean(top.location),root=$mvc.isNodeRuntime?global:window,root.m={description:"Model Data Property"},root.v={description:"View Template Property"},root.c={description:"Control Property"},$mvc.root=root,$mvc.console=function(e,o,t,n){if(n=n||1,$mvc.logLevel>=n)if(console.time)switch(e){case"time":console.time(o);break;case"timeEnd":console.timeEnd(o);break;case"group":t=t||"#666",console.group("%c"+o,"color:"+t);break;case"groupEnd":console.groupEnd(o);break;case"log":t=t||"#111",console.log("%c"+o,"color:"+t);break;case"warn":t=t||"f96",console.warn("%c"+o,"color"+t)}else switch(e){case"log":console.log(o);break;case"warn":console.warn(o);break;case"error":console.error(o)}},$mvc.sAjaxSequence=[],$mvc.sAjax=function(e){function o(){if(4==c.readyState){for(var o=0;o<$mvc.sAjaxSequence.length;o++)setTimeout(function(){$mvc.sAjaxSequence=$mvc.sAjaxSequence.slice(0,o-1).concat($mvc.sAjaxSequence.slice(o,$mvc.sAjaxSequence.length-1))},e.delay);e.finishCallback(c.status,c.responseText)}}function t(){var e=null;try{e=new XMLHttpRequest}catch(o){try{e=new ActiveXObject("Msxml2.XMLHTTP")}catch(o){e=new ActiveXObject("Microsoft.XMLHTTP")}}return e}if(e={name:e.name||"null",crackCallback:e.crackCallback||function(e){console.warn("sAjax(name:"+e+") is canceled because of an unfinished same sAjax!")},url:e.url||window.location.href,method:e.method||"GET",header:e.header||{},contentType:e.contentType||"application/x-www-form-urlencoded",content:e.content||"",async:!!e.async||!0,delay:e.delay||100,finishCallback:e.finishCallback||function(){}},e.header["Content-Type"]=e.contentType,e.contentType.match(/application\/x-www-form-urlencoded/g)){if(e.header.push({"X-Requested-With":"XMLHttpRequest"}),"object"==typeof e.content){var n="";for(var a in e.content)n=n?n+"&"+encodeURIComponent(a)+"="+encodeURIComponent(e.content[a]):encodeURIComponent(a)+"="+encodeURIComponent(e.content[a]);e.content=n}}else JSON&&"object"==typeof e.content&&(e.content=JSON.stringify(e.content));if(!e.name)return void console.error("$mvc.sAjax param.name can not be omitted!");for(var r=0;r<$mvc.sAjaxSequence.length;r++)if($mvc.sAjaxSequence[r]==e.name)return void e.crackCallback(e.name);$mvc.sAjaxSequence.push(e.name);var c=null;if(c=t(),null==c)return void alert("Your brower dose not support AJAX!");c.onreadystatechange=o,c.open(e.method,e.url,e.async);for(var a in e.header)c.setRequestHeader(a,e.header[a]);return c.send(e.content),e},$mvc.onload=function(e,o){function t(){if(e(),o){$mvc.mapNode.autoMold();for(var t in $mvc.mapNode.Molds)compile(t,$mvc.mapNode.Molds[t])}}window.addEventListener?window.addEventListener("load",function(e){t()}):window.attachEvent("onload",function(e){t()})},$mvc.regex={},$mvc.regex.NodeMark=new RegExp("{{2,3}[^{}]*}{2,3}","g"),$mvc.mapNode={},$mvc.mapNode.Molds={},$mvc.mapNode.getElementsByAttributeName=function(e,o){e=e||document;for(var t=e.getElementsByTagName("*"),n=[],a=0;a<t.length;a++)if(t[a].attributes)for(var r=0;r<t[a].attributes.length;r++)t[a].attributes[r].nodeName&&t[a].attributes[r].nodeName==o&&n.push(t[a]);return n},$mvc.mapNode.autoMold=function(e){$mvc.mapNode.Molds=[];for(var o=$mvc.mapNode.getElementsByAttributeName(e,"mvc-template"),t=0;t<o.length;t++)$mvc.mapNode.Mold(o[t].attributes["mvc-template"].value,o[t])},$mvc.mapNode.Mold=function(e,o,t,n){var a;e&&(o=o||document.body,a={node:o,nodeMarks:[],nodeRepeats:[],sourceHTML:o.innerHTML,beforeCompile:t,afterCompile:n},$mvc.mapNode.Molds[e]=a)},$mvc.mapNode.restore=function(e){restore($mvc.mapNode.Molds[e])},$mvc.mapNode.compile=function(e){if($mvc.mapNode.Molds[e]){$mvc.mapNode.Molds[e].beforeCompile?$mvc.mapNode.Molds[e].beforeCompile():null;var o=compile(e,$mvc.mapNode.Molds[e]);return $mvc.mapNode.Molds[e].afterCompile?$mvc.mapNode.Molds[e].afterCompile():null,o}return console.warn('cannot find template mold by templateName "'+e+'"'),{}},root.$mvc=$mvc}(this);