!function(top){"use strict";function restore(e){return e.nodeMarks=[],e.nodeRepeats=[],e.node.innerHTML=e.sourceHTML,e}function compile(e,t){return $mvc.console("group","$mvc compile",5),$mvc.console("log","Template Name : "+e,"#33f",5),$mvc.console("log","Template Element TagName : "+t.node.localName,"#69f",5),t.node.id?$mvc.console("log","Template Element Id : "+t.node.id,"#69f",5):null,t.node.className?$mvc.console("log","Template Element Class : "+t.node.className,"#69f",5):null,$mvc.console("time","Elapsed Time"),$mvc.mapNode.restore(e,t),t=filtRepeatNode(t),t=filtNodeMarks(t),t=compileNodeMarks(t),$mvc.console("log","Template Repeats : "+t.nodeRepeats.length,"#69f",5),$mvc.console("log","Template Marks : "+t.nodeMarks.length,"#69f",5),$mvc.console("timeEnd","Elapsed Time",5),$mvc.console("groupEnd","$mvc compile",5),t}function filtRepeatNode(nodeData){function mapChildFindRepeat(node,tier){for(var i=0;i<node.childNodes.length;i++)if(node.childNodes[i].attributes){for(var n=0;n<node.childNodes[i].attributes.length;n++)if(node.childNodes[i].attributes[n].nodeName&&"mvc-repeat"==node.childNodes[i].attributes[n].nodeName){var tierRegExp=new RegExp("\\$"+tier,"g"),tempRepeat={repeatMark:node.childNodes[i].attributes[n].nodeValue,repeatHTML:node.childNodes[i].innerHTML,repeatTier:tier};nodeData.nodeRepeats.push(tempRepeat);var repeatTimes=0,compileHTML="";if("object"==eval("typeof("+tempRepeat.repeatMark+")"))for(repeatTimes;repeatTimes<eval(tempRepeat.repeatMark+".length");repeatTimes++){var tempHTML=tempRepeat.repeatHTML;tempHTML=tempHTML.replace(tierRegExp,repeatTimes),compileHTML+=tempHTML}else $mvc.console("warn",tempRepeat.repeatMark+" is not Array!",null,1);node.childNodes[i].innerHTML=compileHTML,mapChildFindRepeat(node.childNodes[i],tier+1);break}n==node.childNodes[i].attributes.length&&mapChildFindRepeat(node.childNodes[i],tier)}}return mapChildFindRepeat(nodeData.node,0),nodeData}function filtNodeMarks(e){return e.nodeMarks=e.node.innerHTML.match($mvc.regex.NodeMark)||[],e}function compileNodeMarks(nodeData){for(var htmlStr=nodeData.node.innerHTML,mapedMarks=nodeData.nodeMarks,mark3LRegex=new RegExp("{{{"),mark3RRegex=new RegExp("}}}"),markFixRegex=[new RegExp("{","g"),new RegExp("}","g"),new RegExp("<","g"),new RegExp(">","g"),new RegExp('}}=""',"g"),new RegExp('"',"g")],tempMark,tempStr,isTrueElement,i=0;i<mapedMarks.length;i++)isTrueElement=mark3LRegex.test(mapedMarks[i])&&mark3RRegex.test(mapedMarks[i]),htmlStr=htmlStr.replace(markFixRegex[4],"}}"),tempMark=mapedMarks[i].replace(markFixRegex[0],""),tempMark=tempMark.replace(markFixRegex[1],""),"undefined"!=eval("typeof("+tempMark+")")?(tempStr=String(eval(tempMark)),isTrueElement?null:tempStr=tempStr.replace(markFixRegex[2],"&#60;"),isTrueElement?null:tempStr=tempStr.replace(markFixRegex[3],"&#62;"),htmlStr=htmlStr.replace(mapedMarks[i],tempStr)):htmlStr=htmlStr.replace(mapedMarks[i],"");return nodeData.node.innerHTML!==htmlStr&&(nodeData.node.innerHTML=htmlStr),nodeData}var root={},$mvc={name:"mvc9.js(mvc9.com)",version:"0.9.1 Beta",logLevel:0};$mvc.isNodeRuntime=!Boolean(top.location),root=$mvc.isNodeRuntime?global:window,root.m={description:"Model Data Property"},root.v={description:"View Template Property"},root.c={description:"Control Property"},$mvc.root=root,$mvc.console=function(e,t,o,n){if(n=n||1,$mvc.logLevel>=n)if(console.time)switch(e){case"time":console.time(t);break;case"timeEnd":console.timeEnd(t);break;case"group":o=o||"#666",console.group("%c"+t,"color:"+o);break;case"groupEnd":console.groupEnd(t);break;case"log":o=o||"#111",console.log("%c"+t,"color:"+o);break;case"warn":o=o||"f96",console.warn("%c"+t,"color"+o)}else switch(e){case"log":console.log(t);break;case"warn":console.warn(t);break;case"error":console.error(t)}},$mvc.httpComSequence=[],$mvc.httpCom=function(e){function t(){if(4==m.readyState){for(var t=0;t<$mvc.httpComSequence.length;t++)setTimeout(function(){$mvc.httpComSequence=$mvc.httpComSequence.slice(0,t-1).concat($mvc.httpComSequence.slice(t,$mvc.httpComSequence.length-1))},e.delay);e.finishCallback(m.status,m.responseText)}}function o(){var e=null;try{e=new XMLHttpRequest}catch(t){try{e=new ActiveXObject("Msxml2.XMLHTTP")}catch(t){e=new ActiveXObject("Microsoft.XMLHTTP")}}return e}if(e={name:e.name||"null",crackCallback:e.crackCallback||function(e){console.warn("httpCom(name:"+e+") is canceled because of an unfinished same httpCom!")},url:e.url||window.location.href,method:e.method||"GET",header:e.header||{},contentType:e.contentType||"application/x-www-form-urlencoded",content:e.content||"",async:!!e.async||!0,delay:e.delay||100,finishCallback:e.finishCallback||function(){}},e.header["Content-Type"]=e.contentType,e.contentType.match(/application\/x-www-form-urlencoded/g)){if(e.header.push({"X-Requested-With":"XMLHttpRequest"}),"object"==typeof e.content){var n="";for(var a in e.content)n=n?n+"&"+encodeURIComponent(a)+"="+encodeURIComponent(e.content[a]):encodeURIComponent(a)+"="+encodeURIComponent(e.content[a]);e.content=n}}else JSON&&"object"==typeof e.content&&(e.content=JSON.stringify(e.content));if(!e.name)return void console.error("$mvc.httpCom param.name can not be omitted!");for(var r=0;r<$mvc.httpComSequence.length;r++)if($mvc.httpComSequence[r]==e.name)return void e.crackCallback(e.name);$mvc.httpComSequence.push(e.name);var m=null;if(m=o(),null==m)return void alert("Your brower dose not support AJAX!");m.onreadystatechange=t,m.open(e.method,e.url,e.async);for(var a in e.header)m.setRequestHeader(a,e.header[a]);return m.send(e.content),e},$mvc.onload=function(e,t){function o(){if(e(),t){$mvc.mapNode.autoMold();for(var o in $mvc.mapNode.Molds)compile(o,$mvc.mapNode.Molds[o])}}window.addEventListener?window.addEventListener("load",function(e){o()}):window.attachEvent("onload",function(e){o()})},$mvc.regex={},$mvc.regex.NodeMark=new RegExp("{{2,3}[^{}]*}{2,3}","g"),$mvc.mapNode={},$mvc.mapNode.Molds={},$mvc.mapNode.getElementsByAttributeName=function(e,t){e=e||document;for(var o=e.getElementsByTagName("*"),n=[],a=0;a<o.length;a++)if(o[a].attributes)for(var r=0;r<o[a].attributes.length;r++)o[a].attributes[r].nodeName&&o[a].attributes[r].nodeName==t&&n.push(o[a]);return n},$mvc.mapNode.autoMold=function(e){$mvc.mapNode.Molds=[];for(var t=$mvc.mapNode.getElementsByAttributeName(e,"mvc-template"),o=0;o<t.length;o++)$mvc.mapNode.Mold(t[o].attributes["mvc-template"].value,t[o])},$mvc.mapNode.Mold=function(e,t,o,n){var a;e&&(t=t||document.body,a={node:t,nodeMarks:[],nodeRepeats:[],sourceHTML:t.innerHTML,beforeCompile:o,afterCompile:n},$mvc.mapNode.Molds[e]=a)},$mvc.mapNode.restore=function(e){restore($mvc.mapNode.Molds[e])},$mvc.mapNode.compile=function(e){if($mvc.mapNode.Molds[e]){$mvc.mapNode.Molds[e].beforeCompile?$mvc.mapNode.Molds[e].beforeCompile():null;var t=compile(e,$mvc.mapNode.Molds[e]);return $mvc.mapNode.Molds[e].afterCompile?$mvc.mapNode.Molds[e].afterCompile():null,t}return console.warn('cannot find template mold by templateName "'+e+'"'),{}},root.$mvc=$mvc}(this);